name: sync-secrets
description: sync secrets from 1Password to GH
runtime: yaml
config:
  'pulumi:tags': {value: {'pulumi:template': yaml}}
  github:owner:
        value: conda-forge
variables:
  cirun-api-key:
    fn::invoke:
      function: onepassword:getItem
      arguments:
        title: cirun-api-key
        vault: pulumi
  repo-admin-migrations:
    fn::invoke:
      function: github:getRepository
      arguments:
        fullName: conda-forge/admin-migrations
  repo-admin-requests:
    fn::invoke:
      function: github:getRepository
      arguments:
        fullName: conda-forge/admin-requests
  repo-automerge-action:
    fn::invoke:
      function: github:getRepository
      arguments:
        fullName: conda-forge/automerge-action
  repo-by-the-numbers:
    fn::invoke:
      function: github:getRepository
      arguments:
        fullName: conda-forge/by-the-numbers
  repo-core-notes:
    fn::invoke:
      function: github:getRepository
      arguments:
        fullName: conda-forge/core-notes
  repo-conda-forge-feedstock-ops:
    fn::invoke:
      function: github:getRepository
      arguments:
        fullName: conda-forge/conda-forge-feedstock-ops
  repo-conda-forge-webservices:
    fn::invoke:
      function: github:getRepository
      arguments:
        fullName: conda-forge/conda-forge-webservices
  repo-webservices-dispatch-action:
    fn::invoke:
      function: github:getRepository
      arguments:
        fullName: conda-forge/webservices-dispatch-action
resources:
  onepassword-provider:
    type: pulumi:providers:onepassword
    options:
      version: 1.1.4
      pluginDownloadURL: github://api.github.com/1Password/
  gh-org-secret-cirun-api-key:
    type: github:ActionsOrganizationSecret
    options:
      protect: false
      retainOnDelete: true
      deleteBeforeReplace: false
    properties:
      secretName: CIRUN_API_KEY
      plaintextValue: ${cirun-api-key.credential}
      visibility: selected
      selectedRepositoryIds:
        - ${repo-admin-requests.repoId}
outputs: {}
